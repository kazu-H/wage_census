"0","df_master <-NULL"
"0",""
"0",""
"0","for(i in files){"
"0","  "
"0","  #フォルダによって年の文字の視点を変える"
"0","  #ディレクトリの名前に依存しないように、後ろから数える"
"0","  year <-  i %>% str_sub(start = -15,end = -12) %>% as.numeric()"
"0","  "
"0","  if(year<2020){"
"0","    school_list <- school_list_before2020"
"0","  } "
"0","  else {"
"0","    school_list <- school_list_after2020"
"0","  }"
"0","  "
"0","  sheet_name_list <- i %>% excel_sheets()"
"0","  len_sheet <- length(sheet_name_list)"
"0","  "
"0","  #dfを小さく分割して、それぞれをdfとして縦につなげていく"
"0","  firm_num <- length(firm_size_list)"
"0","  sex_num <- length(sex_list)"
"0","  school_num <- length(school_list)"
"0","  "
"0","  multip <- school_num"
"0","  "
"0","  block_num <- firm_num*sex_num*school_num"
"0","  "
"0","  const <- firm_num*school_num"
"0","  "
"0","  for(j in 1:len_sheet){"
"0",""
"0","    tmp <- read_xlsx(i,"
"0","         sheet = j,"
"0","         col_names = FALSE,"
"0","         range = str_c(""D13:AI"",13*sex_num*school_num+12)) %>% "
"0","      mutate_all(as.numeric) %>% "
"0","      mutate_all(~replace_na(.,0))"
"0","      "
"0","    for(k in 1:block_num){"
"0","      "
"0","      firm_cat <- ceiling((k - const*(ceiling(k/const)-1))/multip)"
"0","      sex_cat <- ceiling(k/firm_num/school_num)"
"0","      school_cat <- (k-(school_num*floor((k-1)/school_num)))"
"0","      "
"0","      "
"0","      vertical_start <-1+ length(age_list)*(k -sex_num*school_num*floor((k-1)/sex_num/school_num)-1)"
"0","      horizontal_start <- 1 + length(var_list)*(ceiling(k/sex_num/school_num)-1)"
"0","      "
"0","      df <- tmp[vertical_start:(vertical_start+length(age_list)-1),"
"0","                horizontal_start:(horizontal_start+length(var_list)-1)]"
"0","      "
"0",""
"0","      colnames(df) <- var_list"
"0","      df[""age_group""] <-  age_list"
"0","      df[""sex""] <- sex_list[sex_cat]"
"0","      df[""firm""] <- firm_size_list[firm_cat]"
"0","      df[""school""] <- school_list[school_cat]"
"0","      df[""ind""] <- sheet_name_list[j]"
"0","      df[""year""] <- year"
"0","      "
"0","      df <- df %>% select(year,sex,age_group,ind,firm,school,everything())"
"0","      "
"0","      df_master <- rbind(df_master,df)"
"0","    "
"0","   }"
"0","  }"
"0","}"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"2","New names:"
"0","write.csv(df_master,here(""treated_data"",""一般労働者全体_賃金構造基本統計調査.csv""),fileEncoding = ""cp932"")"
"0",""
